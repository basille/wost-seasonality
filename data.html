<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Data preprocessing | Joint seasonality in geographic and ecological spaces, illustrated with a partially migratory bird</title>
  <meta name="description" content="Study of seasonal patterns of wood stork, both in geographic space (distribution) and environmental space (climatic niche)." />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Data preprocessing | Joint seasonality in geographic and ecological spaces, illustrated with a partially migratory bird" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Study of seasonal patterns of wood stork, both in geographic space (distribution) and environmental space (climatic niche)." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Data preprocessing | Joint seasonality in geographic and ecological spaces, illustrated with a partially migratory bird" />
  
  <meta name="twitter:description" content="Study of seasonal patterns of wood stork, both in geographic space (distribution) and environmental space (climatic niche)." />
  

<meta name="author" content="Mathieu Basille, James Watling, Stephanie RomaÃ±ach, Rena Borkhataria" />


<meta name="date" content="2019-10-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="niches.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="_custom.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Climatic niche in space and time</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>2</b> Data preprocessing</a><ul>
<li class="chapter" data-level="2.1" data-path="data.html"><a href="data.html#data-import-gps-and-raster-data"><i class="fa fa-check"></i><b>2.1</b> Data import: GPS and raster data</a></li>
<li class="chapter" data-level="2.2" data-path="data.html"><a href="data.html#environmental-intersection"><i class="fa fa-check"></i><b>2.2</b> Environmental intersection</a></li>
<li class="chapter" data-level="2.3" data-path="data.html"><a href="data.html#sampling-the-point-data"><i class="fa fa-check"></i><b>2.3</b> Sampling the point data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="niches.html"><a href="niches.html"><i class="fa fa-check"></i><b>3</b> Climatic niches in space and time</a><ul>
<li class="chapter" data-level="3.1" data-path="niches.html"><a href="niches.html#utilization-distributions"><i class="fa fa-check"></i><b>3.1</b> Utilization distributions</a></li>
<li class="chapter" data-level="3.2" data-path="niches.html"><a href="niches.html#monthly-climatic-niches"><i class="fa fa-check"></i><b>3.2</b> Monthly climatic niches</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="figures.html"><a href="figures.html"><i class="fa fa-check"></i><b>4</b> Manuscript figures</a><ul>
<li class="chapter" data-level="4.1" data-path="figures.html"><a href="figures.html#fig.1-monthly-ranges-and-climatic-niches"><i class="fa fa-check"></i><b>4.1</b> Fig.1: Monthly ranges and climatic niches</a></li>
<li class="chapter" data-level="4.2" data-path="figures.html"><a href="figures.html#fig.2-overlap-matrices"><i class="fa fa-check"></i><b>4.2</b> Fig.2: Overlap matrices</a></li>
<li class="chapter" data-level="4.3" data-path="figures.html"><a href="figures.html#fig.3-marginality"><i class="fa fa-check"></i><b>4.3</b> Fig.3: Marginality</a></li>
<li class="chapter" data-level="4.4" data-path="figures.html"><a href="figures.html#metadata-s1-animation-over-the-year"><i class="fa fa-check"></i><b>4.4</b> Metadata S1: Animation over the year</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="session.html"><a href="session.html"><i class="fa fa-check"></i><b>5</b> R session information</a></li>
<li class="chapter" data-level="6" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>6</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Joint seasonality in geographic and ecological spaces, illustrated with a partially migratory bird</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data" class="section level1">
<h1><span class="header-section-number">2</span> Data preprocessing</h1>
<div id="data-import-gps-and-raster-data" class="section level2">
<h2><span class="header-section-number">2.1</span> Data import: GPS and raster data</h2>
<p>I start by importing GPS data of adults only (without individuals from the Jacksonville zoo), in the form of trajectories (<code>ltraj</code>) that is converted to point data (<code>SpatialPointsDataFrame</code>) and projected to Lat/Long:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;hab&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;Data/wost-ad-ltraj.RData&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;rgdal&quot;</span>)
wost &lt;-<span class="st"> </span>hab::<span class="kw">ltraj2spdf</span>(trajad, <span class="dt">strict =</span> <span class="ot">FALSE</span>, <span class="dt">proj4string =</span> <span class="kw">CRS</span>(<span class="st">&quot;+init=epsg:32617&quot;</span>))
wost$id &lt;-<span class="st"> </span><span class="kw">factor</span>(wost$id)
wost &lt;-<span class="st"> </span><span class="kw">subset</span>(wost, !(id %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">407680</span>, <span class="dv">429200</span>, <span class="dv">476550</span>, <span class="dv">721310</span>, <span class="dv">721320</span>)))
wost &lt;-<span class="st"> </span><span class="kw">spTransform</span>(wost, <span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>))
<span class="kw">summary</span>(wost)</code></pre></div>
<pre><code>## Object of class SpatialPointsDataFrame
## Coordinates:
##         min       max
## x -91.45783 -78.01650
## y  25.08267  34.60033
## Is projected: FALSE 
## proj4string :
## [+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0]
## Number of points: 445638
## Data attributes:
##       date                           dx                  dy            
##  Min.   :2005-07-29 07:00:00   Min.   :-90334.77   Min.   :-127323.69  
##  1st Qu.:2007-09-28 19:00:00   1st Qu.:   -30.13   1st Qu.:    -19.90  
##  Median :2009-07-09 17:00:00   Median :     0.00   Median :      0.00  
##  Mean   :2009-04-11 15:12:47   Mean   :     5.56   Mean   :    -12.55  
##  3rd Qu.:2010-10-29 20:00:00   3rd Qu.:    31.28   3rd Qu.:     19.58  
##  Max.   :2011-12-31 18:00:00   Max.   :133219.05   Max.   : 148420.54  
##                                NA&#39;s   :36011       NA&#39;s   :36011       
##       dist                 dt             R2n               
##  Min.   :     0.00   Min.   :3600    Min.   :            0  
##  1st Qu.:    16.76   1st Qu.:3600    1st Qu.:       108970  
##  Median :    49.76   Median :3600    Median :      9802756  
##  Mean   :  1544.56   Mean   :4777    Mean   :  24050154883  
##  3rd Qu.:   639.01   3rd Qu.:7200    3rd Qu.:   1192219334  
##  Max.   :150312.14   Max.   :7200    Max.   :1005475966130  
##  NA&#39;s   :36011       NA&#39;s   :22863                          
##    abs.angle        rel.angle            id             burst       
##  Min.   :-3.14    Min.   :-3.14    572931 : 29866   414590 : 21736  
##  1st Qu.:-1.57    1st Qu.:-1.57    414590 : 21736   414240 : 18336  
##  Median : 0.00    Median : 0.15    414240 : 18336   414580 : 14595  
##  Mean   : 0.09    Mean   : 0.18    721290 : 16319   416110 : 14110  
##  3rd Qu.: 1.57    3rd Qu.: 2.04    723560 : 15763   407700 : 13064  
##  Max.   : 3.14    Max.   : 3.14    414580 : 14595   414260 : 12473  
##  NA&#39;s   :110418   NA&#39;s   :143287   (Other):329023   (Other):351324  
##       gid           elevation           day      
##  Min.   :148996   Min.   :-999.0   Min.   : 429  
##  1st Qu.:293034   1st Qu.:   3.0   1st Qu.:1220  
##  Median :456866   Median :  10.0   Median :1870  
##  Mean   :442556   Mean   :-173.2   Mean   :1781  
##  3rd Qu.:584878   3rd Qu.:  28.0   3rd Qu.:2347  
##  Max.   :701216   Max.   :2032.0   Max.   :2775  
##                   NA&#39;s   :22873</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wost2 &lt;-<span class="st"> </span><span class="kw">droplevels</span>(wost@data)
<span class="kw">length</span>(<span class="kw">unique</span>(wost2$id))</code></pre></div>
<pre><code>## [1] 61</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(wost2$id)</code></pre></div>
<pre><code>## 
## 407700 407710 414240 414250 414260 414270 414580 414590 414600 414610 
##  13064   1463  18336   5676  12473   2523  14595  21736   8671    628 
## 416100 416110 425120 429190 475171 475180 475192 475220 475241 475270 
##    651  14110   5093  11316   2683  11720    650   2137     19   4867 
## 475282 475284 475302 475322 519770 519790 519800 519810 572661 572662 
##   1790   1245   2729    505   8973   7306   8909   7876   3998   3839 
## 572671 572710 572741 572742 572743 572781 572800 572811 572931 572951 
##   1083  10281    346   2268   3202   4386   1098   5881  29866   7911 
## 572981 572991 721290 721300 723560 723570 723580 723600 723610 809320 
##   4614   8626  16319   9859  15763   2824   2134   2910   7459   5638 
## 809330 809340 910200 910210 910220 910230 910240 992250 992270 992280 
##    805   9165  13990  14474  14269  14105   3372   9188   7607   8761 
## 992290 
##   7853</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(<span class="kw">as.numeric</span>(<span class="kw">table</span>(wost2$id)))</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##      19    2523    5881    7306   10280   29870</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sd</span>(<span class="kw">as.numeric</span>(<span class="kw">table</span>(wost2$id)))</code></pre></div>
<pre><code>## [1] 6036.537</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(<span class="kw">unlist</span>(<span class="kw">by</span>(wost2, wost2$id, function(k) <span class="kw">difftime</span>(<span class="kw">max</span>(k$date), <span class="kw">min</span>(k$date), 
    <span class="dt">units =</span> <span class="st">&quot;days&quot;</span>))))</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1.25  247.50  527.50  649.10  972.30 2326.00</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sd</span>(<span class="kw">unlist</span>(<span class="kw">by</span>(wost2, wost2$id, function(k) <span class="kw">difftime</span>(<span class="kw">max</span>(k$date), <span class="kw">min</span>(k$date), 
    <span class="dt">units =</span> <span class="st">&quot;days&quot;</span>))))</code></pre></div>
<pre><code>## [1] 562.5885</code></pre>
<!-- Jacksonville zoo -->
<!-- 407680 (5 years) -->
<!-- 429200 (4.5 years) -->
<!-- 476550 (1.5 years) -->
<!-- 721310 (3.5 years) -->
<!-- 721320 (1 month) -->
<!-- Weird -->
<!-- 414610 (2.5 months) -->
<!-- 475192 (1.5 month) -->
<!-- 475241 (2 days) -->
<!-- 572671 (2 months) -->
<!-- 572742 (5 months) -->
<p>I also import environmental data (from files). All rasters are combined in a <code>RasterBrick</code>, which is then masked using a Minimum convex polygon (from <code>adehabitatHR</code>) of every relocations enlarged by a one-cell buffer:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;raster&quot;</span>)
janPrec &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/jan_prec.img&quot;</span>)
janTemp &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/jan_temp.img&quot;</span>)
febPrec &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/feb_prec.img&quot;</span>)
febTemp &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/feb_temp.img&quot;</span>)
marPrec &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/mar_prec.img&quot;</span>)
marTemp &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/mar_temp.img&quot;</span>)
aprPrec &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/apr_prec.img&quot;</span>)
aprTemp &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/apr_temp.img&quot;</span>)
mayPrec &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/may_prec.img&quot;</span>)
mayTemp &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/may_temp.img&quot;</span>)
junPrec &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/jun_prec.img&quot;</span>)
junTemp &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/jun_temp.img&quot;</span>)
julPrec &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/jul_prec.img&quot;</span>)
julTemp &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/jul_temp.img&quot;</span>)
augPrec &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/aug_prec.img&quot;</span>)
augTemp &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/aug_temp.img&quot;</span>)
sepPrec &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/sep_prec.img&quot;</span>)
sepTemp &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/sep_temp.img&quot;</span>)
octPrec &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/oct_prec.img&quot;</span>)
octTemp &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/oct_temp.img&quot;</span>)
decPrec &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/dec_prec.img&quot;</span>)
decTemp &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/dec_temp.img&quot;</span>)
novPrec &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/nov_prec.img&quot;</span>)
novTemp &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;Data/Consensus_rasters/nov_temp.img&quot;</span>)
(rast &lt;-<span class="st"> </span><span class="kw">brick</span>(janPrec, janTemp, febPrec, febTemp, marPrec, marTemp, aprPrec, 
    aprTemp, mayPrec, mayTemp, junPrec, junTemp, julPrec, julTemp, augPrec, 
    augTemp, sepPrec, sepTemp, octPrec, octTemp, novPrec, novTemp, decPrec, 
    decTemp))</code></pre></div>
<pre><code>## class      : RasterBrick 
## dimensions : 855, 2156, 1843380, 24  (nrow, ncol, ncell, nlayers)
## resolution : 0.167, 0.167  (x, y)
## extent     : -180, 180.052, -59.1665, 83.6185  (xmin, xmax, ymin, ymax)
## crs        : NA 
## source     : /tmp/Rtmp4OILip/raster/r_tmp_2019-10-30_173244_13787_41238.grd 
## names      : jan_prec, jan_temp, feb_prec, feb_temp, mar_prec, mar_temp, apr_prec, apr_temp, may_prec, may_temp, jun_prec, jun_temp, jul_prec, jul_temp, aug_prec, ... 
## min values :     0.00,   -51.45,     0.00,   -47.45,     0.00,   -44.55,     0.00,   -35.75,     0.00,   -19.80,     0.00,   -13.55,     0.00,   -10.85,     0.00, ... 
## max values :   808.90,    33.10,   714.15,    32.45,   689.05,    32.25,   632.15,    33.90,   965.00,    35.80,  2136.30,    38.35,  2123.25,    38.20,  1538.70, ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;rgeos&quot;</span>)
sa &lt;-<span class="st"> </span><span class="kw">mcp</span>(wost, <span class="dt">percent =</span> <span class="dv">100</span>)
rast &lt;-<span class="st"> </span><span class="kw">crop</span>(rast, <span class="kw">gBuffer</span>(sa, <span class="dt">width =</span> <span class="fl">0.167</span>))
rast &lt;-<span class="st"> </span><span class="kw">mask</span>(rast, <span class="kw">gBuffer</span>(sa, <span class="dt">width =</span> <span class="fl">0.167</span>))</code></pre></div>
<p>The result is something like this (using temperatures in January as an example)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;sf&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;maps&quot;</span>)
states &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(<span class="kw">map</span>(<span class="st">&quot;state&quot;</span>, <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>))
rastDF &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">rasterToPoints</span>(rast))
<span class="kw">library</span>(<span class="st">&quot;cowplot&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;viridis&quot;</span>)
<span class="kw">ggplot</span>() +<span class="st"> </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> rastDF, <span class="kw">aes_string</span>(<span class="dt">x =</span> <span class="st">&quot;x&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">fill =</span> <span class="kw">names</span>(rastDF)[<span class="dv">4</span>])) +<span class="st"> </span>
<span class="st">    </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> states, <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">size =</span> <span class="fl">0.2</span>, <span class="dt">colour =</span> <span class="kw">gray</span>(<span class="fl">0.2</span>)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw">data.frame</span>(wost), 
    <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y), <span class="dt">shape =</span> <span class="dv">20</span>, <span class="dt">size =</span> <span class="fl">0.8</span>, <span class="dt">stroke =</span> <span class="dv">0</span>, <span class="dt">colour =</span> <span class="st">&quot;gray&quot;</span>) +<span class="st"> </span>
<span class="st">    </span><span class="kw">coord_sf</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(-<span class="dv">92</span>, -<span class="fl">77.5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="fl">24.5</span>, <span class="dv">35</span>), <span class="dt">expand =</span> <span class="ot">FALSE</span>) +<span class="st"> </span><span class="kw">scale_fill_viridis</span>(<span class="dt">end =</span> <span class="fl">0.8</span>, 
    <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">option =</span> <span class="st">&quot;plasma&quot;</span>) +<span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Latitude&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="dt">fill =</span> <span class="kw">expression</span>(<span class="st">`</span><span class="dt">Temperature </span><span class="st">`</span>(degree ~<span class="st"> </span>
<span class="st">    </span>C))) +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="dt">legend.justification =</span> <span class="st">&quot;center&quot;</span>) +<span class="st"> </span>
<span class="st">    </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_colourbar</span>(<span class="dt">barwidth =</span> <span class="dv">15</span>, <span class="dt">barheight =</span> <span class="dv">1</span>, <span class="dt">title.theme =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">26</span>)))</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:data-plot"></span>
<img src="_main_files/figure-html/data-plot-1.png" alt="Temperature in January." width="70%" />
<p class="caption">
Figure 2.1: Temperature in January.
</p>
</div>
</div>
<div id="environmental-intersection" class="section level2">
<h2><span class="header-section-number">2.2</span> Environmental intersection</h2>
<p>We first look at the frequency of data for each month:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;lubridate&quot;</span>)
wost$month &lt;-<span class="st"> </span><span class="kw">month</span>(wost$date)
<span class="kw">table</span>(wost$month)</code></pre></div>
<pre><code>## 
##     1     2     3     4     5     6     7     8     9    10    11    12 
## 28931 26156 30298 33741 40787 38467 42136 44483 43625 42663 38409 35942</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">table</span>(wost$month), <span class="dt">ylab =</span> <span class="st">&quot;Frequency&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Month&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:data-month"></span>
<img src="_main_files/figure-html/data-month-1.png" alt="Frequency of data per month." width="70%" />
<p class="caption">
Figure 2.2: Frequency of data per month.
</p>
</div>
<p>We then intersect the GPS data to the precipitation and temperature layers, using the month number to identify the correct layer:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wost$prec &lt;-<span class="st"> </span><span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">1</span>, <span class="kw">extract</span>(janPrec, wost),
    <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">2</span>, <span class="kw">extract</span>(febPrec, wost),
        <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">3</span>, <span class="kw">extract</span>(marPrec, wost),
            <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">4</span>, <span class="kw">extract</span>(aprPrec, wost),
                <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">5</span>, <span class="kw">extract</span>(mayPrec, wost),
                    <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">6</span>, <span class="kw">extract</span>(junPrec, wost),
                        <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">7</span>, <span class="kw">extract</span>(julPrec, wost),
                            <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">8</span>, <span class="kw">extract</span>(augPrec, wost),
                                <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">9</span>, <span class="kw">extract</span>(sepPrec, wost),
                                    <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">10</span>, <span class="kw">extract</span>(octPrec, wost),
                                        <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">11</span>, <span class="kw">extract</span>(novPrec, wost),
                                            <span class="kw">extract</span>(decPrec, wost))))))))))))
wost$temp &lt;-<span class="st"> </span><span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">1</span>, <span class="kw">extract</span>(janTemp, wost),
    <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">2</span>, <span class="kw">extract</span>(febTemp, wost),
        <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">3</span>, <span class="kw">extract</span>(marTemp, wost),
            <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">4</span>, <span class="kw">extract</span>(aprTemp, wost),
                <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">5</span>, <span class="kw">extract</span>(mayTemp, wost),
                    <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">6</span>, <span class="kw">extract</span>(junTemp, wost),
                        <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">7</span>, <span class="kw">extract</span>(julTemp, wost),
                            <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">8</span>, <span class="kw">extract</span>(augTemp, wost),
                                <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">9</span>, <span class="kw">extract</span>(sepTemp, wost),
                                    <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">10</span>, <span class="kw">extract</span>(octTemp, wost),
                                        <span class="kw">ifelse</span>(wost$month ==<span class="st"> </span><span class="dv">11</span>, <span class="kw">extract</span>(novTemp, wost),
                                            <span class="kw">extract</span>(decTemp, wost))))))))))))</code></pre></div>
<p>Note that the correlation between temperature and precipitation in wood stork use data is pretty high.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(wost$prec, wost$temp, <span class="dt">use =</span> <span class="st">&quot;complete.obs&quot;</span>)</code></pre></div>
<pre><code>## [1] 0.7965986</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(wost$prec, wost$temp, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">xlab =</span> <span class="st">&quot;Precipitation&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Temperature&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:data-env-cor"></span>
<img src="_main_files/figure-html/data-env-cor-1.png" alt="Correlation between precipitation and temperature." width="70%" />
<p class="caption">
Figure 2.3: Correlation between precipitation and temperature.
</p>
</div>
</div>
<div id="sampling-the-point-data" class="section level2">
<h2><span class="header-section-number">2.3</span> Sampling the point data</h2>
<p>In this section, I will sample GPS data to ensure that each individual is represented equally in each month. I first break down the data into a list with one element per month. Over this list, i.e.Â for each month, individuals with less than 100 locations are removed, and one random location of a random individual (with replacement) is chosen 5000 times, to give each individual the same weight in the sampled data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(wost$id, wost$month)</code></pre></div>
<pre><code>##         
##             1    2    3    4    5    6    7    8    9   10   11   12
##   407680    0    0    0    0    0    0    0    0    0    0    0    0
##   407700  956  856  897  911 1040  950 1325 1371 1211 1257 1295  995
##   407710    0    0    0    0    0    0  323  308  329  342  161    0
##   414240 1488 1328 1486 1490 1579 1595 1633 1638 1551 1555 1453 1540
##   414250  266  311  313  539  637  619  629  693  617  467  290  295
##   414260  947  739  781 1057 1232 1062 1207 1189 1087 1090 1040 1042
##   414270    0    0    0  175  317  320  337  327  308  348  319   72
##   414580  903  855  962 1390 1376 1416 1632 1504 1404 1233  945  975
##   414590 1530 1373 1637 1902 1980 1937 2058 1963 1927 1990 1840 1599
##   414600  620  556  554  872  887  809  801  872  778  728  615  579
##   414610    0    0    0  148  244  236    0    0    0    0    0    0
##   416100    0    0   36  285  330    0    0    0    0    0    0    0
##   416110 1005  883 1061 1269 1546 1250 1336 1348 1113 1163 1075 1061
##   425120  144  132  223  398  466  444  791  692  710  535  374  184
##   429190  890  718  851  847  952  887 1086 1122 1065  983 1013  902
##   429200    0    0    0    0    0    0    0    0    0    0    0    0
##   475171   41   10  279  302  424  491  285  302  174  175  114   86
##   475180  508  680 1148 1112 1206 1020 1210 1087 1090  982  968  709
##   475192    0    0    0  331  319    0    0    0    0    0    0    0
##   475220   94   68  172  242  229  221  217  232  194  208  195   65
##   475241    0    0    0    0    0    0   19    0    0    0    0    0
##   475270  277  238  623  659  670  652  530  476  262  142  217  121
##   475282    0    0    0    0    0    0  356  426  422  434  152    0
##   475284    0    0    0   20  155  150  156  155  150  154  150  155
##   475302  317  336  359  396  313    0   24  241   53  133  275  282
##   475322    0    0    0    0    0    0    0   58  437   10    0    0
##   476550    0    0    0    0    0    0    0    0    0    0    0    0
##   519770  457  411  487  452  703  887  926  945  912  952  895  946
##   519790  467  428  470  439  472  446  617  898  907  917  763  482
##   519800  462  412  475  432  655  907  959  947  914  936  877  933
##   519810  470  440  477  446  438  423  625  949  920  901  889  898
##   572661  213    0    0  365  469  319  465  468  456  455  336  452
##   572662  156    0    0    0  440  444  434  472  459  480  474  480
##   572671    0    0    0  385  454  244    0    0    0    0    0    0
##   572710  712  724 1151 1145 1186 1025  704  641  725  777  723  768
##   572741    0    0    0    0    0    0    0  131  215    0    0    0
##   572742    0    0    0    0    0    0  255  444  449  464  404  252
##   572743  429  384   45    0  427  201  117  214  371  422  250  342
##   572781  444   20   32  439  467  346  456  442  459  439  384  458
##   572800    0    0  115  136  121  194  201  245   86    0    0    0
##   572811  460  407  454  450  455  391  430  151  554  892  780  457
##   572931 2456 2360 2416 2385 2420 2141 2434 2611 2786 2727 2541 2589
##   572951  892  786  468  452  423  268  446  643  899  905  858  871
##   572981  464  396  466  403  408  208   42  481  453  433  442  418
##   572991  797  737  856  745  451  286  463  879  841  875  849  847
##   721290  959 1038 1366 1259 1352 1548 1745 1805 1782 1672  940  853
##   721300  804  864  909  826  684  664  909  900  847  815  781  856
##   721310    0    0    0    0    0    0    0    0    0    0    0    0
##   721320    0    0    0    0    0    0    0    0    0    0    0    0
##   723560 1101 1215 1345 1307 1405 1336 1351 1395 1358 1381 1301 1268
##   723570    0    0    0  120  360  323  355  351  354  368  321  272
##   723580    0    0    0   45  356  298  363  359  339  353   21    0
##   723600    0    0    0  120  361  326  370  363  356  369  360  285
##   723610  471  470  826  768  633  738  696  757  758  559  406  377
##   809320  439  410  461  457  647  465  473  476  452  456  454  448
##   809330    0    0    0    0  135  477  193    0    0    0    0    0
##   809340  891  588  453  434  576  830  909  926  852  900  901  905
##   910200  875  794  955  863 1340 1248 1342 1284 1296 1361 1334 1298
##   910210  913  844  924  887 1353 1309 1364 1377 1357 1406 1367 1373
##   910220  906  811  950  917 1371 1271 1367 1390 1331 1364 1338 1253
##   910230  930  819  935  906 1282 1252 1304 1319 1322 1364 1342 1330
##   910240    0    0    0    0  444  418  458  470  455  483  448  196
##   992250  445  434  460  472  813  923  948  964  942  954  900  933
##   992270  466  439  487  450  676  927  928  956  729  484  441  624
##   992280  431  407  457  441  657  911  922  918  904  916  890  907
##   992290  435  435  476  450  451  414  610  908  903  954  908  909</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(<span class="kw">as.numeric</span>(<span class="kw">table</span>(wost$id)))</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##       0    1876    5366    6752    9691   29870</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">months &lt;-<span class="st"> </span><span class="kw">split</span>(wost, wost$month)
for (i in <span class="dv">1</span>:<span class="kw">length</span>(months)) months[[i]]$id &lt;-<span class="st"> </span><span class="kw">factor</span>(months[[i]]$id)
monthLocs &lt;-<span class="st"> </span><span class="kw">lapply</span>(months, function(k) {
    k &lt;-<span class="st"> </span><span class="kw">nsubset</span>(k, id, <span class="dv">100</span>)
    k$id &lt;-<span class="st"> </span><span class="kw">factor</span>(k$id)
    lt &lt;-<span class="st"> </span><span class="kw">split</span>(k, k$id)
    <span class="kw">set.seed</span>(<span class="dv">34138</span>)
    sam &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span>:<span class="kw">length</span>(lt), <span class="dv">5000</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
    <span class="kw">return</span>(<span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, <span class="kw">lapply</span>(sam, function(x) {
        lt[[x]][<span class="kw">sample</span>(<span class="dv">1</span>:<span class="kw">nrow</span>(lt[[x]]), <span class="dv">1</span>), ]
    })))
})
monthLocsAll &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, monthLocs)
<span class="kw">table</span>(monthLocsAll$month)</code></pre></div>
<pre><code>## 
##    1    2    3    4    5    6    7    8    9   10   11   12 
## 5000 5000 5000 5000 5000 5000 5000 5000 5000 5000 5000 5000</code></pre>
<p>Here is the result on the map of temperatures in January:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() +<span class="st"> </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> <span class="kw">data.frame</span>(<span class="kw">rasterToPoints</span>(rast)), <span class="kw">aes_string</span>(<span class="dt">x =</span> <span class="st">&quot;x&quot;</span>, 
    <span class="dt">y =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">fill =</span> <span class="kw">names</span>(rast)[<span class="dv">4</span>])) +<span class="st"> </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> states, <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">size =</span> <span class="fl">0.2</span>, 
    <span class="dt">colour =</span> <span class="kw">gray</span>(<span class="fl">0.2</span>)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw">data.frame</span>(wost), <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y), 
    <span class="dt">shape =</span> <span class="dv">20</span>, <span class="dt">size =</span> <span class="fl">0.8</span>, <span class="dt">stroke =</span> <span class="dv">0</span>, <span class="dt">colour =</span> <span class="st">&quot;gray&quot;</span>) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw">subset</span>(<span class="kw">data.frame</span>(monthLocsAll), 
    month ==<span class="st"> </span><span class="dv">1</span>), <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y), <span class="dt">shape =</span> <span class="dv">15</span>) +<span class="st"> </span><span class="kw">coord_sf</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(-<span class="dv">92</span>, -<span class="fl">77.5</span>), 
    <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="fl">24.5</span>, <span class="dv">35</span>), <span class="dt">expand =</span> <span class="ot">FALSE</span>) +<span class="st"> </span><span class="kw">scale_fill_viridis</span>(<span class="dt">end =</span> <span class="fl">0.8</span>, <span class="dt">alpha =</span> <span class="dv">1</span>, 
    <span class="dt">option =</span> <span class="st">&quot;plasma&quot;</span>) +<span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Latitude&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="dt">fill =</span> <span class="kw">expression</span>(<span class="st">`</span><span class="dt">Temperature </span><span class="st">`</span>(degree ~<span class="st"> </span>
<span class="st">    </span>C))) +<span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="dt">legend.justification =</span> <span class="st">&quot;center&quot;</span>) +<span class="st"> </span>
<span class="st">    </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_colourbar</span>(<span class="dt">barwidth =</span> <span class="dv">15</span>, <span class="dt">barheight =</span> <span class="dv">1</span>, <span class="dt">title.theme =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">26</span>)))</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:data-plot-sample-jan"></span>
<img src="_main_files/figure-html/data-plot-sample-jan-1.png" alt="Wood stork location data (blue dots), with January temperatures in the background and January locations in black." width="70%" />
<p class="caption">
Figure 2.4: Wood stork location data (blue dots), with January temperatures in the background and January locations in black.
</p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="niches.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
